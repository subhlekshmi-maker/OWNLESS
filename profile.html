<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OWN/LESS - Profile</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="profile-container">
        <!-- Header -->
        <header class="dashboard-header">
            <div class="header-left">
                <div class="header-logo-circle">
                    <svg class="header-logo-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"
                            fill="#9333ea" />
                    </svg>
                </div>
                <div class="header-brand">
                    <h1 class="header-brand-name">OWN/LESS</h1>
                    <p class="header-brand-subtitle">VIT Exchange</p>
                </div>
            </div>
            <nav class="header-nav">
                <a href="home.html" class="nav-item">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M3 7V5C3 3.9 3.9 3 5 3H19C20.1 3 21 3.9 21 5V7" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round" />
                        <path d="M3 7L12 13L21 7" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                            stroke-linejoin="round" />
                        <path d="M3 7V19C3 20.1 3.9 21 5 21H19C20.1 21 21 20.1 21 19V7" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                    <span>Browse</span>
                </a>
                <a href="messages.html" class="nav-item">
                    <div class="nav-icon-wrapper">
                        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M21 15C21 15.5304 20.7893 16.0391 20.4142 16.4142C20.0391 16.7893 19.5304 17 19 17H7L3 21V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H19C19.5304 3 20.0391 3.21071 20.4142 3.58579C20.7893 3.96086 21 4.46957 21 5V15Z"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                        <span class="badge">1</span>
                    </div>
                    <span>Messages</span>
                </a>
                <a href="profile.html" class="nav-item active profile-nav">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M20 21V19C20 17.9391 19.5786 16.9217 18.8284 16.1716C18.0783 15.4214 17.0609 15 16 15H8C6.93913 15 5.92172 15.4214 5.17157 16.1716C4.42143 16.9217 4 17.9391 4 19V21"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                            stroke-linejoin="round" />
                    </svg>
                    <span>Profile</span>
                </a>
                <a href="#" class="nav-item">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                            stroke-linejoin="round" />
                        <path d="M12 5L19 12L12 19" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                            stroke-linejoin="round" />
                    </svg>
                </a>
            </nav>
        </header>

        <!-- Main Content -->
        <main class="profile-main">
            <!-- Profile Banner -->
            <div class="profile-banner">
                <div class="profile-avatar-large">
                    <span>D</span>
                </div>
                <div class="profile-info">
                    <h2 class="profile-name">dfgdhth</h2>
                    <div class="profile-detail">
                        <svg class="profile-detail-icon" viewBox="0 0 24 24" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M4 4H20C21.1 4 22 4.9 22 6V18C22 19.1 21.1 20 20 20H4C2.9 20 2 19.1 2 18V6C2 4.9 2.9 4 4 4Z"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                            <path d="M22 6L12 13L2 6" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" />
                        </svg>
                        <span>dfgdhth@vitstudent.ac.in</span>
                    </div>
                    <div class="profile-detail">
                        <svg class="profile-detail-icon" viewBox="0 0 24 24" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                            <path d="M16 2V6" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" />
                            <path d="M8 2V6" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" />
                            <path d="M3 10H21" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" />
                        </svg>
                        <span>Member since Feb 2026</span>
                    </div>
                    <div class="verified-badge">
                        <svg class="verified-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"
                                fill="currentColor" />
                        </svg>
                        <span>Verified VIT Student</span>
                    </div>
                </div>
            </div>

            <!-- Statistics Section -->
            <div class="profile-stats">
                <div class="stat-card">
                    <div class="stat-icon-wrapper purple">
                        <svg class="stat-card-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M21 16V8C20.9996 7.64928 20.9071 7.30481 20.7315 7.00116C20.556 6.69751 20.3037 6.44536 20 6.27L13 2.27C12.696 2.09446 12.3511 2.00205 12 2.00205C11.6489 2.00205 11.304 2.09446 11 2.27L4 6.27C3.69626 6.44536 3.44398 6.69751 3.26846 7.00116C3.09294 7.30481 3.00036 7.64928 3 8V16C3.00036 16.3507 3.09294 16.6952 3.26846 16.9988C3.44398 17.3025 3.69626 17.5546 4 17.73L11 21.73C11.304 21.9055 11.6489 21.9979 12 21.9979C12.3511 21.9979 12.696 21.9055 13 21.73L20 17.73C20.3037 17.5546 20.556 17.3025 20.7315 16.9988C20.9071 16.6952 20.9996 16.3507 21 16Z"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                    </div>
                    <div class="stat-number">0</div>
                    <div class="stat-label">Items Listed</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon-wrapper green">
                        <svg class="stat-card-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M3 3V21H21" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" />
                            <path d="M7 16L12 11L16 15L21 10" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round" />
                            <path d="M21 10H16V15" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" />
                        </svg>
                    </div>
                    <div class="stat-number">0</div>
                    <div class="stat-label">For Borrow</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon-wrapper blue">
                        <svg class="stat-card-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M20 21V19C20 17.9391 19.5786 16.9217 18.8284 16.1716C18.0783 15.4214 17.0609 15 16 15H8C6.93913 15 5.92172 15.4214 5.17157 16.1716C4.42143 16.9217 4 17.9391 4 19V21"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                            <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" />
                        </svg>
                    </div>
                    <div class="stat-number">0</div>
                    <div class="stat-label">For Sale</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon-wrapper pink">
                        <svg class="stat-card-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M20.84 4.61C20.3292 4.099 19.7228 3.69364 19.0554 3.41708C18.3879 3.14052 17.6725 2.99817 16.95 2.99817C16.2275 2.99817 15.5121 3.14052 14.8446 3.41708C14.1772 3.69364 13.5708 4.099 13.06 4.61L12 5.67L10.94 4.61C9.9083 3.57831 8.50903 2.99871 7.05 2.99871C5.59096 2.99871 4.19169 3.57831 3.16 4.61C2.1283 5.64169 1.54871 7.04097 1.54871 8.5C1.54871 9.95903 2.1283 11.3583 3.16 12.39L4.22 13.45L12 21.23L19.78 13.45L20.84 12.39C21.351 11.8792 21.7564 11.2728 22.0329 10.6054C22.3095 9.93789 22.4518 9.22248 22.4518 8.5C22.4518 7.77752 22.3095 7.0621 22.0329 6.39464C21.7564 5.72718 21.351 5.12075 20.84 4.61Z"
                                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                    </div>
                    <div class="stat-number">0</div>
                    <div class="stat-label">Favorites</div>
                </div>
            </div>

            <!-- Tabs Section -->
            <div class="profile-tabs-container">
                <div class="profile-tabs">
                    <button class="profile-tab active">My Listings (0)</button>
                    <button class="profile-tab">Favorites (0)</button>
                </div>
                <div class="profile-tab-content">
                    <!-- Content will be displayed here -->
                </div>
            </div>
        </main>

        <!-- Help Icon -->
        <button class="help-icon">
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="12" cy="12" r="10" fill="currentColor" />
                <path
                    d="M9.09 9C9.3251 8.33167 9.78915 7.76811 10.4 7.40913C11.0108 7.05016 11.7289 6.91894 12.4272 7.03871C13.1255 7.15849 13.7588 7.52152 14.2151 8.06353C14.6713 8.60553 14.9211 9.29152 14.92 10C14.92 12 11.92 13 11.92 13"
                    stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                <path d="M12 17H12.01" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
        </button>
    </div>
    <script type="module">
        import { requireAuth, getCurrentUser } from "./src/auth.js";
        import { getProfile, getMyListings } from "./src/profile.js";
        import { deleteItem } from "./src/items.js";

        await requireAuth();

        const user = await getCurrentUser();
        const profile = await getProfile();
        let listings = await getMyListings();

        // UI Elements
        const nameEl = document.querySelector(".profile-name");
        const emailEl = document.querySelector(".profile-detail span");
        const avatarEl = document.querySelector(".profile-avatar-large span");
        const joinDateEl = document.querySelector(".profile-detail:nth-child(2) span");

        const statsListings = document.querySelector(".stat-card:nth-child(1) .stat-number");
        const statsBorrow = document.querySelector(".stat-card:nth-child(2) .stat-number");
        const statsSale = document.querySelector(".stat-card:nth-child(3) .stat-number");
        const tabListings = document.querySelector(".profile-tab:nth-child(1)");
        const tabContent = document.querySelector(".profile-tab-content");

        // Update basic info
        if (profile) {
            nameEl.textContent = profile.full_name || profile.username || user.email.split("@")[0];
            emailEl.textContent = user.email;
            avatarEl.textContent = (nameEl.textContent[0] || "U").toUpperCase();

            const date = new Date(user.created_at);
            joinDateEl.textContent = "Member since " + date.toLocaleString('default', { month: 'short', year: 'numeric' });
        }

        // Update Stats
        statsListings.textContent = listings.length;
        statsBorrow.textContent = listings.filter(i => i.mode === "lend").length;
        statsSale.textContent = listings.filter(i => i.mode === "sell").length;

        tabListings.textContent = `My Listings (${listings.length})`;

        // Render Listings
        function renderListings() {
            tabContent.innerHTML = "";
            if (listings.length === 0) {
                tabContent.innerHTML = `<p style="text-align:center; padding: 2rem; color: #666;">No listings yet.</p>`;
                return;
            }

            const grid = document.createElement("div");
            grid.className = "items-grid";

            listings.forEach(item => {
                const card = document.createElement("div");
                card.className = "item-card";

                const badge = item.mode.toUpperCase();
                const price = item.price ? `â‚¹${item.price}` : "Free";

                card.innerHTML = `
            <div class="item-badge ${item.mode}">${badge}</div>
            <div class="item-image">
              <div class="placeholder-image"></div>
            </div>
            <h3>${item.title}</h3>
            <p>${item.description}</p>
            <p><strong>${price}</strong></p>
            <button class="submit-btn" style="background: #ef4444;" onclick="deleteItem('${item.id}')">Delete</button>
          `;
                grid.appendChild(card);
            });

            tabContent.appendChild(grid);
        }

        renderListings();

        window.deleteItem = async (id) => {
            if (!confirm("Are you sure you want to delete this listing?")) return;

            const success = await deleteItem(id);
            if (success) {
                // Remove from local array
                listings = listings.filter(item => item.id !== id);
                // Re-render
                renderListings();
                // Update stats
                document.querySelector(".stat-card:nth-child(1) .stat-number").textContent = listings.length;
                document.querySelector(".stat-card:nth-child(2) .stat-number").textContent = listings.filter(i => i.mode === "lend").length;
                document.querySelector(".stat-card:nth-child(3) .stat-number").textContent = listings.filter(i => i.mode === "sell").length;
                document.querySelector(".profile-tab:nth-child(1)").textContent = `My Listings (${listings.length})`;
            }
        };
    </script>
</body>

</html>